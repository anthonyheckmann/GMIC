<!DOCTYPE html>
<html lang="en-us"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../tutorial.css">
<body>

<h1>-blur_selective</h1>
<p><img src="img/_blur_selective_fm_b4naftr.jpg" title="Before and after: selective blur noise removal. " class="img_block" style="margin: 3px; border: 0px solid #808080; float: left;" height="200" width="200" />Selective blur aims to preserve edges while reducing noise. Both phenomena exhibit very high rates of change, but noise tends to random, mutually cancelling impulses while edges exhibit a degree of coherency. This command tends to agressively blur noise in locales where the average rate of change is relatively low, impulses notwithstanding as these tend to cancel out, while avoiding regions where pixels clump into distinct populations of color or luminosity that give rise to edge locales of rapid average color and luminosity change.</p>
<p>The command has the following format:</p>
<p>-blur_selective: sigma&gt;=0,_edges&gt;0,_nb_scales&gt;0</p>
<ul>
<li><em>sigma:</em> sets the standard variation, or spread of a gaussian kernel for blurring in regions of locally constant color and luminosity. a non-negative number. One must supply a value, there are no defaults. The actual blurring in a particular locale will be less, or even zero, in the proximity of edges. See _nb_scales, below.</li>
<li><em>_edges:</em> sets edge sensitivity. Higher numbers (greater than unity) tends toward preserving edges, but also noise. Lower numbers (0.01 - 0.4) permits more aggressive blurring, but can cause edges to disappear. The optimal value depends on particularities of images; 0.5 is a good starting point. The parameter is optional and defaults to 0.5.</li>
<li><em>_nb_scales:</em> sets the number of steps in degree of blurring from the maximum established by sigma, above, and zero (no blurring whatsoever). The actual standard variation applied to a particular locale depends on the average rate of change of color or luminosity in that locale, tending to zero as the local rate of change in color or luminosity increases. Higher values divide the range between zero and sigma into a greater number of smaller steps. Larger numbers tend to eliminate mach banding, but the command runs longer. This parameter is optional and defaults to 5 steps.</li>
</ul>
<h2>Selective Gaussian Scaling</h2>
<p><img style="float: left; margin: 3px; border: 0px solid #808080;" class="img_block" src="img/_blur_selective_fm.jpg" height="750" width="450" />-blur_selective has two goals: preserve edges and smooth noise out of regions which, on average, do not change much, such as the blue background of the happy face or the yellow areas of the face. The second goal favors blurring, but this is not conducive to the first: preserving edges.</p>
<p>To resolve this, -blur_selective employs -<a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#gradient_norm">gradient_norm</a> as an edge detector. -gradient_norm produces a gray scale image where regions of rapid luminance or chromatic change in the subject image translate to light regions in the output, which are otherwise dark. It is sensitive to noise, but even more sensitive to the abutting of dissimilar regions in the original, producing a stronger signal &mdash; an edge &mdash; than noise pixels in isolation.&nbsp;</p>
<p>The command generates extraction masks from a <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#quantize">-quantize</a>d version of the gradient norm, one for each scale specified by <em>nb_scales</em>. The masks stemming from the lighter portions of the gradient norm isolate edges in the original, those stemming from dark region isolate portions of constant color and luminance in the subject&nbsp; </p>
<p>the extraction masks it generates reflect this property. The first mask selects regions reflecting rapid changes in luminance in the subject image, such as around edges. The others select regions which exhibit progressively lower rates.</p>
<p>&nbsp;The extraction masks achieve these goals because they form a progression. The very first mask in the series selects regions of rapid change, the last regions of gradual change.</p>
<p>The blur_selective command iterates over the extraction masks, starting with the first mask. At each iteration, the command harnesses the extraction mask to copy a region of the subject image and then blurs the subject image a fraction &mdash; in particular, the fraction of<em> sigma</em> over the number of scales, less one. The first extraction mask copies from an unblurred version of the subject image, and since this first mask isolates mainly edges, edges are copied off to a save-set before the the blurring step of the first iteration occurs. The command then blurs the subject image and the iteration repeats.</p>
<p>&nbsp;As the iteration proceeds, the extraction masks select from progressively blurred versions of the subject image. At each stage, noise &mdash; <em>and edges</em> &mdash; are softened in the subject image, but since earlier stages of the iteration had preserved the edge-like regions of the subject image in save-sets, the deteriation of edges in the subject image are of no concern.</p>
<p>The latter masks serve the second goal. These extract regions to save-sets that exhibited more constant luminance in the original subject image &mdash; regions that have been blurred &mdash; and denoised &mdash; in subsequent iterations. The save-sets produced toward the end of the iteration contain the relatively constant regions in the original subject image, regions that have now been deblurred by one or more blurring steps.</p>
<p><em>Garry Osgood</em></p>




</body></html>