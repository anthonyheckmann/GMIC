<!DOCTYPE html>
<html lang="en-us"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../tutorial.css">
<body>

<h1>Cauldron, Anyone?</h1>
<p><img src="img/cauldron_imgstack.jpg" title="Blurring through image slices" class="img_block" style="margin: 3px; border: 1px solid #808080; float: left;" height="252" width="400" />The <a target="_parent" href="images.shtml">G'MIC image</a> has three spatial dimensions; it is mostly out of habit and custom that many people (this writer included) generally <a target="_parent" href="http://www.urbandictionary.com/define.php?term=fuhgeddaboudit">fuhgeddaboudit</a> and only use single-slice, two dimensional images. That is a shame, as many G'MIC commands do their bidding in three dimensions as well as two. They are untapped sources of cheap (in terms of rendering time) animation.</p>
<p>The diagram on the left illustrates how the <a target="_parent" href="_blur.shtml">-blur</a> command behaves when an image has more than one slice. An orange pixel affects neighbors along the z axis (depth) as well as along the x and y axes. Play these slices as an animation and the blurred pixel becomes a kind of a pop! explosion.</p>
<p>The <a target="_parent" href="_bandpass.shtml">-bandpass</a> command also operates in three dimensions. In other places, we've harnessed this command for <span class="internal">spectral filtering</span>, eliding all but a subset of frequencies in the original image. Taking an image with such truncated spectral content back into spatial domain gives rise to a set of sine waves that do not quite <a target="_parent" href="http://particularart.com/static/media/uploads/command_reference/bandpass/wnb.png">reconstitute the original</a>; we see patterns of constructive reinforcement and destructive interference that would not have been especially noticable had we not erased those parts of the spectrum needed to reconstitute the original.</p>
<p>The key idea in this Cookbook piece is this: -bandpass, like many G'MIC commands work in three dimensions. And when we think Animation, that extra dimension can be time. The following example happens to use the -bandpass command, but the techniques presented here aren't married to that command. They can be generalized to any other command which operates 'in the round' over slices as well as the width and height of images.</p>
<h2 class="western">Pipeline</h2>
<p>Here is a pipeline that produces a kind of a cauldron effect. The nice thing about clips produced by this pipeline is that they can be seamlessly looped without a 'pop' crossing from the end to the beginning of the loop. Details follow.</p>
<p><code href="/tools-and-toys/gmic/command-guide/-repeat/">$ gmic 100 360,240,900,3 <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#noise">-noise</a>[-1] 0.2,2 <a target="_parent" href="_bandpass.shtml">-bandpass</a> 0.005,0.02 <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#normalize">-normalize</a> 0,255 \<br /><a target="_parent" href="_display.shtml">-display</a> <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#split">-split</a> z <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#output"><span class="internal">-o</span>utput</a> /path/to/your/animation.mov</code></p>
<ol>
<li>First, we <a target="_parent" title="Conjuring Images out of the Aether and Other Generators" href="/tools-and-toys/gmic/images/conjuring-images/">conjure from the aether</a> a contiguous volume 320 pixels wide, 240 pixels high and nine hundred slices deep, sufficient for a thirty second video clip. We salt-and-pepper a fairly sparse pattern of pixels. If you scrub through the image volume at this point in the pipeline (insert <a target="_parent" href="_display.shtml">-display</a> after -noise), the animation would have the appearance of dirty film. To this sparse noise we apply a low-pass spectral filter, using the <a target="_parent" href="_bandpass.shtml">-bandpass</a> command. The lower relative cutoff frequency is 0.005, the upper relative cutoff frequency is 0.02.</li>
<li>Behind the scenes, the -bandpass command harnesses the Fast Fourier Transform, embodied in the <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#fft">-fft</a> command, converting the three dimensional array of pixels into a similar array of spectral coefficients, this through a process of <a target="_parent" href="http://en.wikipedia.org/wiki/Fourier_analysis">Fourier analysis</a>. It then deletes all but a hollow sphere of coefficients around the spectral space origin. The lower and upper relative cutoff frequencies set the thickness of this shell and establish the overall character of the animation. By 'cutoff,' we mean that we set coefficients beyond these limits to zero and preserve coefficients within.</li>
<li>Here, we picked low relative frequencies, producing only very large features that seem quite blurry, characteristics of a low pass frequency filter. Larger relative frequencies would give rise to high-pass filters, admitting smaller, sharper features, while the difference between the numbers controls the amount of variation in feature size. Experimenting with these numbers can give rise to a great deal of variety in texture and variation. The -noise command also affects the texture of the pattern, particularly for larger values of cutoff frequencies.</li>
<li>With a much-elided set of spectral coefficients, the -bandpass command invokes the <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#ifft">-ifft</a> command, partially reconstituting the spatial image through the inverse process of Fourier synthesis.</li>
<li>At the end of the command pipeline, housekeeping prevails. The reconstituted image generally will not be in a range suitable for presentation display; -normalize shifts all intensities into the 0,255 range, a suitable width for eight bit color animation. We use the -split command in preparation for -output, a command which can create a video, but which needs a sequence of one slice images. By way of particular file extensions, you can specify one of five multimedia containers: Quicktime (.mov), Motion Picture Expert Group (.mpeg),&nbsp; Flash (.flv), Ogg/Vorbis (.ogg) or Audio Video Interleaved (.avi). This pipeline harnesses the Quicktime container.</li>
<li>The multimedia file produced by the -output command runs at 25 frames per second and contains an mpeg-2 video stream, which can be played on a wide range of hardware. If you need to tailor the multimedia stream in more precise ways, save the stream as an image sequence. Choose a lossless image file format like Portable Network Graphic images (.png). The resulting <span class="external">sequence of numbered files <a target="_parent" href="http://cinelerra.org/docs/split_manual_en/cinelerra_cv_manual_en_5.html#Image-sequence">may be imported</a></span> via a .toc file ("<a target="_parent" href="http://particularart.com/static/media/uploads/BeginnersCookbook/cauldron/example.toc">table of contents file</a>") into a video editor like <a target="_parent" href="http://cinelerra.org/">cinelerra</a>.</li>
</ol>
<h3>Cauldron</h3>
<p><video id="cauldron" width="360" height="240" style="float:left;margin:7px;" poster="/static/media/uploads/BeginnersCookbook/cauldron/cauldron.png" preload="metadata" controls="controls"><source src="http://particularart.com/static/media/uploads/BeginnersCookbook/cauldron/cauldron.mp4" type="video/mp4" /><source src="http://particularart.com/static/media/uploads/BeginnersCookbook/cauldron/cauldron.webm" type="video/webm" /><source src="http://particularart.com/static/media/uploads/BeginnersCookbook/cauldron/cauldron.ogv" type="video/ogg" /><source src="http://particularart.com/static/media/uploads/BeginnersCookbook/cauldron/cauldron.avi" type="video/avi" /><object id="cauldron" width="360" height="240" data="/static/grappelli/tinymce/jscripts/tiny_mce/plugins/media/moxieplayer.swf" type="application/x-shockwave-flash"><param name="src" value="/static/grappelli/tinymce/jscripts/tiny_mce/plugins/media/moxieplayer.swf" /><param name="flashvars" value="url=/static/media/uploads/BeginnersCookbook/cauldron/cauldron.mp4&amp;poster=/static/media/uploads/BeginnersCookbook/cauldron/cauldron.png" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="true" /></object> </video>The video clip on the left is a product of the previous G'MIC command pipeline. It reminds us of percolating liquid in a cauldron. Poetic interpretations aside, we are observing the low frequency components of sparsely scattered noise, a three dimensional interference pattern which our "camera" depicts two dimensionally, displaying slices through time. Particular curdling textures depend very much on the choice of the lower and upper relative cutoff frequencies that we gave to the -bandpass command. Larger relative frequencies give rise to finer, higher frequency detail. The blobs are smaller and seem to curdle faster. A larger difference between relative frequencies admits a wider range of blob sizes. The cutoff frequencies can be set too close together. If the difference between the lower and upper relative frequencies becomes too small, the resulting images may be all black.</p>
<p>Because this sequence is a product of Fourier analysis and synthesis, it can be seamlessly tiled in the x, y, and z dimensions. Not only do the top and bottom and left and right edges match, but the end of the animation segues into the beginning, so this material can be used out of the box in an endless loop without having to worry about a 'pop' as the animation loops around. This characteristic stems entirely from the -bandpass command and the underlying Fourier transform commands, <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#fft">-fft</a> and <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#ifft">-ifft</a>.</p>
<h3>Further Explorations</h3>
<p>Nearly everything we do with G'MIC is not an end in itself, but furnishes stepping stones to other effects. The cauldron animation can furnish displacement fields to distort other visuals, and the cauldron visual need not even appear itself.</p>
<table frame="border" rules="all" class="table, table-striped" border="0" cellpadding="3">
<tbody>
<tr>
<td><img src="img/cauldron_cauldron_title.jpg" title="A Cauldron title" class="img_block" style="margin: 3px; border: 1px solid #808080; float: left;" height="240" width="360" /></td>
<td>
<p>This is a title image made by <a target="_parent" href="http://inkscape.org">Inkscape</a> and then exported as a PNG file. We matched its aspect ratio to the cauldron clip shown in the previous section, 360x240 pixels. Our aim is to composite this title with another video, so we have included an alpha channel in the image file so that the base video will be visible through the transparent regions of this title image.</p>
<p>For this example, we will composite this title with the cauldron clip, harnessing it also to furnish frame-by-frame displacement fields. Our particular approach will be based on G'MIC's <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#warp">-warp</a> command, which uses channel zero of a displacement field image as an image shift source of along the horizontal axis and channel one as a image shift source along the vertical axis. We'll extract these channels from each frame of the caudron clip and apply them to the title image on the right. Since it would be tedious to do this manually for each of the 900 frames in the cauldron clip, we will avail ourselves of a G'MIC loop commands, -repeat &lt;n&gt;... -done</p>
</td>
</tr>
<tr>
<td><video id="cauldron_title" width="360" height="240" style="float:left;margin:7px;border:1px solid #808080;" poster="/static/media/uploads/BeginnersCookbook/cauldron/cauldron_still.png" preload="metadata" controls="controls"><source src="http://particularart.com/static/media/uploads/BeginnersCookbook/cauldron/cauldron_title.mp4" type="video/mp4" /><source src="http://particularart.com/static/media/uploads/BeginnersCookbook/cauldron/cauldron_title.webm" type="video/webm" /><source src="http://particularart.com/static/media/uploads/BeginnersCookbook/cauldron/cauldron_title.ogv" type="video/ogg" /><source src="http://particularart.com/static/media/uploads/BeginnersCookbook/cauldron/cauldron_title.avi" type="video/avi" /><object id="cauldron_title" width="360" height="240" data="/static/grappelli/tinymce/jscripts/tiny_mce/plugins/media/moxieplayer.swf" type="application/x-shockwave-flash"><param name="src" value="/static/grappelli/tinymce/jscripts/tiny_mce/plugins/media/moxieplayer.swf" /><param name="flashvars" value="url=/static/media/uploads/BeginnersCookbook/cauldron/cauldron_title.mp4&amp;poster=/static/media/uploads/BeginnersCookbook/cauldron/cauldron_still.png" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="true" /></object></video></td>
<td>
<p>This is the pipeline of commands that creates an animated warp of the title image. A walk through of this pipeline follows the table:</p>
<p><code>gmic <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#input">-input</a> cauldron.mov <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#repeat">-repeat</a> @# <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#split">--split</a>[0] c <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#remove">-rm</a>[-1] <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#append">-append</a>[-2,-1] c \<br /><a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#normalize">-normalize</a>[-1] 0,30 <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#input">-input</a> cauldron_title.png <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#warp">-warp</a>[-1] [-2],1,1 \<br /><a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#remove">-rm</a>[-2] <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#remove">-rm</a>[0] <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#done">-done</a> <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#output">-output</a> /path/to/your/title/animation/file.mov</code></p>
</td>
</tr>
</tbody>
</table>
<h3>Distorted Title Walkthrough</h3>
<ol>
<li>We input our cauldron clip, making a large image stack. (<code><a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#input">-input</a> cauldron.mov</code>...)</li>
<li>G'MIC -repeat ... -done permits us to iterate a pipeline of commands over the image stack The notation '@#' is one of G'MIC's substitution sequences, this particular one will be replaced with the number of images in the stack. With this substitution, we need not know before hand how many frames a video clip has.</li>
<li>G'MIC applies the mini-pipeline of commands between the -repeat...-done markers for each image in the pipeline. Here, our overall mode of operation is to derive a displacement field from whatever image happens to be at the beginning of the stack and use it to distort a copy of the title, placing the warped title at the end of the image stack.&nbsp; Finally, we remove the first image from the stack. We then repeat. As we proceed, we consume frames from the clip, but leave the corresponding warped title slides at the end of the stack, preserving the original order of the clip. As we proceed, the original animation shapes the warping of the title image.</li>
<li>In each repetition, we split the current frame into its red, green and blue channels, then delete the blue channel as we only need two colors to make a displacement field. (...<code><a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#split">--split</a>[0] c <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#remove">-rm</a>[-1]</code>...)</li>
<li>We compose the displacement field using the --append command and employ -normalize as a warping control. Increasing the second parameter magnifies the effect of the displacement field and the magnitude of the warp. Set to suit your taste; we think 30 is about right for a really dramatic warp. We insert a fresh, unwarped copy of the title image at the end of the stack and invoke a relative warp, using the displacement field, now in the penultimate slot on the stack, to control the warp. (...<code><a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#normalize">-normalize</a>[-1] 0,30 <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#input">-input</a> cauldron_title.png <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#warp">-warp</a>[-1] [-2],1,1</code>...)</li>
<li>The last two commands in the mini-pipeline perform housekeeping. We first remove the displacement field and then the first image in the stack, as both have warped their corresponding title image in the output stream and are no longer needed. (<code><a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#remove">-rm</a>[-2] <a target="_parent" href="http://gmic.sourceforge.net/reference.shtml#remove">-rm</a>[0]</code>)</li>
<li>Leaving the repeat loop, we have a sequence of warped title slides, ordered in the same manner as the frames of the original animation, to which they are related. Here, we write to a Quicktime container, but could also write a sequence of PNG files as well.</li>
</ol>
<p>We used cinelerra to composite the title sequence onto the original cauldron clip.</p>




</body></html>